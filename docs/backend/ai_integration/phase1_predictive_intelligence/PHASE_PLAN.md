# 1단계 계획 – 예측 인텔리전스 기반 구축

## 1. 개요

- **목표:** 강화된 Strategy & Backtest 워크플로우를 유지하면서 FastAPI 라우트를
  방해하지 않고 ML 시그널, 레짐 분류, 확률 KPI 예측과 같은 프로덕션급 예측
  서비스를 제공한다.
- **비즈니스 가치:** 전략·백테스트 결과를 기반으로 시나리오 계획 능력을 높여
  퀀트 트레이더와 투자자의 매매 타이밍 신뢰도와 포트폴리오 리스크 가시성을
  향상시킨다.
- **기간:** 6주 (2025-01-06 → 2025-02-14).

## 2. 범위 및 산출물

| ID  | 산출물           | 설명                                                                                                                 | 승인 기준                                                                                                                                            |
| --- | ---------------- | -------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| D1  | ML 시그널 서비스 | DuckDB 피처를 활용한 LightGBM/CatBoost 모델을 통해 점수를 제공하는 ServiceFactory 등록 `MLSignalService` 엔드포인트. | - DuckDB 피처 파이프라인 문서화<br>- `/signals/{symbol}` 라우트가 확률과 피처 기여도를 반환<br>- BacktestService 오케스트레이터가 시그널 점수를 소비 |
| D2  | 레짐 감지 API    | MongoDB에 영속화하고 `/market-data/regime` 라우트를 노출하는 레짐 분류 워크플로우.                                   | - 배치 작업이 매일 레짐 레이블을 갱신<br>- DashboardService가 KPI 패널과 함께 레짐 메타데이터를 노출                                                 |
| D3  | 확률 KPI 예측    | 백분위 예측을 반환하는 추론 엔진을 PortfolioService와 통합.                                                          | - 예측 엔드포인트가 5/50/95 백분위의 에쿼티 전망치를 제공<br>- DuckDB에 과거 예측 평가 결과 저장                                                     |

### 범위 제외

- 강화학습 실행기(2단계).
- LLM 내러티브 생성(3단계).
- MLflow 배포 자동화(4단계).

## 3. 작업 스트림 및 백로그 매핑

| 작업 스트림     | 백로그 항목 | 비고                                                                                                                                                                                                                          |
| --------------- | ----------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 피처 엔지니어링 | D1, D2      | Strategy & Backtest 아키텍처 다이어그램과 정렬되도록 DuckDB 피처 스토어 확장.【F:docs/backend/strategy_backtest/ARCHITECTURE.md†L1-L120】                                                                                     |
| 모델 개발       | D1, D3      | MarketDataService 통합을 통해 Alpha Vantage 이력 데이터를 활용하여 그래디언트 부스팅 분류기와 예측 모델 학습.【F:docs/backend/ai_integration/master_plan.md†L13-L46】【F:docs/backend/ai_integration/master_plan.md†L47-L82】 |
| 서비스 통합     | D1, D2, D3  | 신규 서비스를 ServiceFactory에 등록하고 BacktestService 오케스트레이터 흐름에 통합.【F:docs/backend/strategy_backtest/ARCHITECTURE.md†L1-L87】                                                                                |
| 분석 활성화     | D2, D3      | 분석가 사용을 위해 DashboardService에 신규 지표 노출.【F:docs/backend/ai_integration/master_plan.md†L47-L82】                                                                                                                 |

## 4. 마일스톤

| 마일스톤           | 날짜       | 담당              | 종료 기준                                                       |
| ------------------ | ---------- | ----------------- | --------------------------------------------------------------- |
| M1: 피처 명세 승인 | 2025-01-10 | 데이터 엔지니어링 | 승인된 피처 목록과 DuckDB 스키마 업데이트                       |
| M2: 모델 학습 완료 | 2025-01-24 | 퀀트 리서치       | 교차 검증 지표 문서화, 모델 아티팩트 저장                       |
| M3: API 통합 리뷰  | 2025-02-05 | 백엔드 팀         | 라우트가 스테이징에 배포되고 ServiceFactory 레지스트리 갱신     |
| M4: 단계 데모      | 2025-02-14 | 프로덕트          | BacktestService가 시그널을 사용하고 예측을 표시하는 실시간 데모 |

## 5. 의존성과 인터페이스

- **Strategy & Backtest 스택:** 데이터 조회와 결과 영속화를 위해 Orchestrator와
  DatabaseManager 파이프라인을
  사용.【F:docs/backend/strategy_backtest/ARCHITECTURE.md†L33-L108】
- **마켓데이터 리프레시 작업:** 제때 피처 계산과 이상 처리에 필요.
- **DuckDB 캐시 및 MongoDB:** 피처, 레짐, 예측을 위한 영속 레이어.
- **분석 대시보드:** 레짐 메타데이터와 확률 KPI의 소비자.

## 6. 위험 및 대응

| 위험                                    | 영향                          | 가능성 | 대응                                                                                                                      |
| --------------------------------------- | ----------------------------- | ------ | ------------------------------------------------------------------------------------------------------------------------- |
| Alpha Vantage 피드의 데이터 공백        | 모델 학습 지연 및 정확도 저하 | 중간   | 마스터 플랜 3.3절에 따른 이상 탐지 훅을 전처리 가드레일로 구현.【F:docs/backend/ai_integration/master_plan.md†L109-L132】 |
| 모델 지연으로 인한 백테스트 런타임 영향 | 중간                          | 낮음   | 모델 아티팩트를 메모리에 캐시하고 야간 작업에서 피처를 사전 계산.                                                         |
| 기존 오케스트레이터와의 통합 복잡성     | 중간                          | 중간   | 서비스 계약을 Strategy & Backtest 다이어그램과 정렬하고 통합 페어링 세션을 일정에 포함.                                   |

## 7. 지표 및 보고

- **선행 지표:** 모델 AUC/정확도, 피처 파이프라인 SLA, 레짐 리프레시 지연.
- **후행 지표:** 백테스트 샤프 지수 개선 폭, 포트폴리오 VaR 커버리지 vs 실제
  손실.
- **품질 게이트:** ServiceFactory 등록, API 계약, 예측 보정 검사를 다루는 자동화
  테스트.

## 8. 리소스 계획

| 역할                | 투입량  | 비고                                     |
| ------------------- | ------- | ---------------------------------------- |
| 백엔드 엔지니어     | 1.5 FTE | API 통합 및 ServiceFactory 업데이트 집중 |
| 데이터 엔지니어     | 1 FTE   | 피처 파이프라인과 DuckDB 오케스트레이션  |
| 퀀트 리서처         | 1 FTE   | 모델 개발 및 검증                        |
| 프로덕트 애널리스트 | 0.5 FTE | KPI 정의, 대시보드 검증                  |

## 9. 커뮤니케이션 주기

- Strategy & Backtest 스쿼드와 주간 스프린트 리뷰.
- 오케스트레이터·DatabaseManager 호환성을 확인하기 위한 단계 중반 아키텍처 리뷰.

## 10. 종료 기준

- 모든 산출물이 자동 회귀 테스트와 함께 스테이징에서 승인.
- 리포 내 문서(피처 명세, API 스키마, 런북) 업데이트.
- Strategy & Backtest 책임자의 인수인계 체크리스트 서명 완료.
